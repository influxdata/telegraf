# Interrupts Input Plugin

The interrupts plugin gathers metrics about IRQs from `/proc/interrupts`, `/proc/softirqs`, 
and `/proc/irq/IRQ_NUMBER/spurious`

### Configuration
```toml
[[inputs.interrupts]]
  ## When set to true, cpu metrics are tagged with the cpu.  Otherwise cpu is
  ## stored as a field.
  ##
  ## The default is false for backwards compatibility, and will be changed to
  ## true in a future version.  It is recommended to set to true on new
  ## deployments.
  # cpu_as_tag = false

  ## To filter which IRQs to collect, make use of tagpass / tagdrop, i.e.
  # [inputs.interrupts.tagdrop]
  #   irq = [ "NET_RX", "TASKLET" ]
```

### Metrics

There are two styles of `interrupts` and `soft_interrupts` depending on the value of `cpu_as_tag`.
When `cpu_as_tag` is `false` the per-CPU count is in a field. When `true` the CPU is a tag and
there is one point per-interrupt per-CPU. Having the CPU as a tag easily allows queries by-CPU at
the cost of requiring greater cardinality. With modern CPUs having > 100 "processors" and capable of
running a large number of threads per driver, cardinality can become large.

For `spurious_interrupts` there is only a per-interrupt counter available; no per-CPU info is 
available.

#### interrupts
The `interrupts` metric reports the hard interrupt data collected from the 
`/proc/interrupts` file in Linux.
These interrupts are typically from hardware devices, but can be also generated by 
software, such as timers and interprocessor communication interrupts.

There are two styles depending on the value of `cpu_as_tag`.

With `cpu_as_tag = false`:

- interrupts
  - tags:
    - irq (IRQ name)
    - type
    - device (name of the device that is located at the IRQ)
    - cpu
  - fields:
    - cpu (int, number of interrupts per cpu)
    - total (int, total number of interrupts)

- soft_interrupts
  - tags:
    - irq (IRQ name)
    - type
    - device (name of the device that is located at the IRQ)
    - cpu
  - fields:
    - cpu (int, number of interrupts per cpu)
    - total (int, total number of interrupts)

With `cpu_as_tag = true`:

- interrupts
  - tags:
    - irq (IRQ name)
    - type
    - device (name of the device that is located at the IRQ)
    - cpu
  - fields:
    - count (int, number of interrupts)

- soft_interrupts
  - tags:
    - irq (IRQ name)
    - type
    - device (name of the device that is located at the IRQ)
    - cpu
  - fields:
    - count (int, number of interrupts)

#### spurious_interrupts
The `spurious_interrupts` metric reports the number of spurious interrupts triggered
and unhandled for IRQs. Data is collected from the `/proc/irq/IRQ/spurious` file.
Data is identified by soft IRQ number/name and is not collected per-CPU.

- spurious_interrupts
  - tags:
    - irq (IRQ name, correlates to soft_interrupts)
  - fields:
    - count (number of times the interrupt has been handled (data stored as modulo 100,000))
    - total (corresponds to soft_interrupts total field)
    - unhandled (number of times an interrupt was not handled)

### Example Output

With `cpu_as_tag = false`:
```
interrupts,irq=0,type=IO-APIC,device=2-edge\ timer,cpu=cpu0 count=23i 1489346531000000000
interrupts,irq=1,type=IO-APIC,device=1-edge\ i8042,cpu=cpu0 count=9i 1489346531000000000
interrupts,irq=30,type=PCI-MSI,device=65537-edge\ virtio1-input.0,cpu=cpu1 count=1i 1489346531000000000
soft_interrupts,irq=NET_RX,cpu=cpu0 count=280879i 1489346531000000000
```

With `cpu_as_tag = true`:
```
interrupts,cpu=cpu6,irq=PIW,type=Posted-interrupt\ wakeup\ event count=0i 1543539773000000000
interrupts,cpu=cpu7,irq=PIW,type=Posted-interrupt\ wakeup\ event count=0i 1543539773000000000
soft_interrupts,cpu=cpu0,irq=HI count=246441i 1543539773000000000
soft_interrupts,cpu=cpu1,irq=HI count=159154i 1543539773000000000
```

Spurious interrupts are reported as a separate metric:
```
spurious_interrupts,device=16-fasteoi\ ehci_hcd:usb1\,\ vmwgfx,irq=16,type=IO-APIC count=12353i,total=12354i,unhandled=1i 1551582077000000000
spurious_interrupts,irq=TIMER count=0i,total=327836i,unhandled=0i 1551582077000000000
```

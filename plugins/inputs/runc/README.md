# Runc Input Plugin

The `runc` plugin collects metrics from [runc](https://github.com/opencontainers/runc) containers on the given host. It executes the `runc` binary directly to query a list of running containers on your system and then collects runtime
metrics for each container that matches the user specified criteria (all containers by default).

**Note**: This plugin must either be run as root or your system must be configured to run [rootless](https://github.com/opencontainers/runc#rootless-container) and an alternate `root` must be specified.


### Configuration:

```toml
# Read metrics from runc containers
[[inputs.runc]]
 ## Path to the runc binary
 command = "/usr/bin/runc"
 ## Runc container root path
 root = "/run/runc"
 ## List of containers to include
 container_name_include = []
 ## List of containers ids to exclude
 container_name_exclude = []

```

### Measurements & Fields:

Metrics are generated by executing `runc` commands directly on the host. The
source code of runc's [cgroups/stats](https://github.com/opencontainers/runc/blob/master/libcontainer/cgroups/stats.go)
provides the exact schema and definitions.

For example, `runc events --stats container-1` will output a similar JSON structure:

```json
{
  "type": "stats",
  "id": "container-1",
  "data": {
    "cpu": {
      "usage": {
        "total": 9494869,
        "percpu": [
          6989690,
          1663589,
          428176,
          413414
        ],
        "kernel": 0,
        "user": 0
      },
      "throttling": {}
    },
    "memory": {
      "usage": {
        "limit": 9223372036854772000,
        "usage": 249856,
        "max": 442368,
        "failcnt": 0
      },
      "swap": {
        "limit": 9223372036854772000,
        "usage": 249856,
        "max": 442368,
        "failcnt": 0
      },
      "kernel": {
        "limit": 9223372036854772000,
        "usage": 188416,
        "max": 188416,
        "failcnt": 0
      },
      "kernelTCP": {
        "limit": 9223372036854772000,
        "failcnt": 0
      },
      "raw": {
        "active_anon": 61440,
        "active_file": 0,
        "cache": 0,
        "dirty": 0,
        "hierarchical_memory_limit": 9223372036854772000,
        "hierarchical_memsw_limit": 9223372036854772000,
        "inactive_anon": 0,
        "inactive_file": 0,
        "mapped_file": 0,
        "pgfault": 85,
        "pgmajfault": 0,
        "pgpgin": 69,
        "pgpgout": 54,
        "rss": 61440,
        "rss_huge": 0,
        "swap": 0,
        "total_active_anon": 61440,
        "total_active_file": 0,
        "total_cache": 0,
        "total_dirty": 0,
        "total_inactive_anon": 0,
        "total_inactive_file": 0,
        "total_mapped_file": 0,
        "total_pgfault": 85,
        "total_pgmajfault": 0,
        "total_pgpgin": 69,
        "total_pgpgout": 54,
        "total_rss": 61440,
        "total_rss_huge": 0,
        "total_swap": 0,
        "total_unevictable": 0,
        "total_writeback": 0,
        "unevictable": 0,
        "writeback": 0
      }
    },
    "pids": {
      "current": 1
    },
    "blkio": {},
    "hugetlb": {}
  }
}
```

These values are flattened slightly to work with Telegraf's data structure and then sent onward. Nested definitions such as `cpu.percpu` are flattened into a key such as `usage_core_0`.


### Tags:

Measurements currently include a single tag `id` which corresponds to the container id.

### Example Output:
```
telegraf --config telegraf.conf --test
* Plugin: inputs.runc, Collection 1
> cpu,id=container-1,host= throttling_throttled_time=0i,usage_user=0i,usage_total=9494869i,usage_kernel=0i,usage_core_0=6989690i,usage_core_1=1663589i,usage_core_2=428176i,throttling_periods=0i,throttling_throttled_periods=0i,usage_core_3=413414i 1500834831000000000
> pids,id=container-1,host= limit=0i,current=1i 1500834831000000000
> memory,id=container-1,host= raw_rss=61440i,raw_total_rss_huge=0i,raw_total_unevictable=0i,raw_pgpgout=54i,raw_total_rss=61440i,raw_total_swap=0i,swap_usage=249856i,usage_usage=249856i,raw_total_inactive_anon=0i,raw_active_anon=61440i,raw_inactive_file=0i,kernel_limit=9223372036854771712i,kernel_usage=188416i,kernel_tcp_max=0i,raw_inactive_anon=0i,raw_pgpgin=69i,raw_total_active_file=0i,usage_failcnt=0i,kernel_max=188416i,raw_total_inactive_file=0i,raw_total_mapped_file=0i,raw_writeback=0i,raw_total_active_anon=61440i,swap_max=442368i,usage_limit=9223372036854771712i,kernel_tcp_limit=9223372036854771712i,raw_total_pgpgout=54i,raw_hierarchical_memory_limit=9223372036854771712i,raw_swap=0i,raw_total_dirty=0i,kernel_tcp_usage=0i,kernel_tcp_failcnt=0i,raw_rss_huge=0i,raw_active_file=0i,raw_hierarchical_memsw_limit=9223372036854771712i,raw_mapped_file=0i,raw_pgmajfault=0i,usage_max=442368i,raw_pgfault=85i,raw_unevictable=0i,raw_total_cache=0i,raw_total_pgmajfault=0i,swap_limit=9223372036854771712i,raw_total_writeback=0i,kernel_failcnt=0i,raw_cache=0i,raw_total_pgpgin=69i,raw_dirty=0i,raw_total_pgfault=85i,cache=0i,swap_failcnt=0i 1500834831000000000
```

# See https://github.com/influxdata/telegraf/tree/master/plugins/parsers/xpath for details
# on the parser settings and syntax.
# Please note: We have to use the special 'xpath_config' section to allow setting up the parser.

data_format = "xpath_json"
metric_name = "amd_rocm_smi"

[[xpath_config]]
  metric_selection = "//*[starts-with(name(.), 'card')]"
  ignore_nan = true

  [xpath_config.tags]
    name = "name()"
    gpu_id = "child::*[name() = 'GPU ID']"
    gpu_unique_id = "child::*[name() = 'Unique ID']"

  [xpath_config.fields]
    temperature_sensor_edge = "number(child::*[name() = 'Temperature (Sensor edge) (C)'])"
    temperature_sensor_junction = "number(child::*[name() = 'Temperature (Sensor junction) (C)'])"
    temperature_sensor_memory = "number(child::*[name() = 'Temperature (Sensor memory) (C)'])"
    power_draw = "number(child::*[name() = 'Average Graphics Package Power (W)'])"
    driver_version = "/system/child::*[name() = 'Driver version']"

  [xpath_config.fields_int]
    fan_speed = "child::*[name() = 'Fan speed (%)']"
    memory_total = "child::*[name() = 'VRAM Total Memory (B)']"
    memory_used = "child::*[name() = 'VRAM Total Used Memory (B)']"
    utilization_gpu = "child::*[name() = 'GPU use (%)']"
    utilization_memory = "child::*[name() = 'GPU memory use (%)']"
    clocks_current_sm = "substring(child::*[name() = 'sclk clock speed:'], 2, string-length(.)-5)"
    clocks_current_memory = "substring(child::*[name() = 'mclk clock speed:'], 2, string-length(.)-5)"

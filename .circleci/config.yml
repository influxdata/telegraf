version: 2.1
orbs:
  win: circleci/windows@5.0.0
  aws-cli: circleci/aws-cli@3.1.1

jobs:
  package-sign-windows:
    executor:
        name: win/default
        shell: powershell.exe
    steps:
      - checkout
      - attach_workspace:
          at: '/build'
      - run:
          name: "Sign Windows Executables"
          shell: powershell.exe
          command: |
            New-Item -Path . -Name "build/dist" -Type Directory
            Invoke-WebRequest -Uri https://dl.influxdata.com/telegraf/nightlies/telegraf-nightly_windows_amd64.zip -OutFile ./build/dist/telegraf-nightly_windows_amd64.zip
            ./scripts/windows-signing.ps1

workflows:
  version: 2
  ci:
    jobs:
      - 'package-sign-windows'
